<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" 
          content="default-src 'self'; 
                   script-src 'self' 'unsafe-inline' https://unpkg.com; 
                   style-src 'self' 'unsafe-inline';
                   img-src 'self' data: https:;
                   connect-src 'self';">
    <title>VietPhu CMS</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTggNEgyNEwyOCAyOEg0TDggNFoiIHN0cm9rZT0iIzAwZmY4OCIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxwYXRoIGQ9Ik0xMiA4TDE2IDE2TDIwIDgiIHN0cm9rZT0iIzAwZmY4OCIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPg==">
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
    <div id="userInfo">
        <div class="login-status" id="loginStatus">Chưa đăng nhập</div>
        <button id="loginBtn" class="btn">Đăng Nhập</button>
        <button id="logoutBtn" class="btn" onclick="componentManager.logout()" style="display: none;">Đăng Xuất</button>
        <button id="usersBtn" class="btn" style="display: none;">Người Dùng</button>
    </div>

    <div class="container">
        <header>
            <div class="header-content">
                <h1>
                    <a href="#" onclick="componentManager.showHomePage()" class="logo-link">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik0yMCAxMkg4MEw5MCA2MEgxMEwyMCAxMloiIHN0cm9rZT0iIzAwZmY4OCIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxwYXRoIGQ9Ik0zNSAyNUw1MCA1MEw2NSAyNSIgc3Ryb2tlPSIjMDBmZjg4IiBzdHJva2Utd2lkdGg9IjIiLz4KPHRleHQgeD0iNTAiIHk9IjgwIiBmb250LXNpemU9IjEyIiBmaWxsPSIjMDBmZjg4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBsZXR0ZXItc3BhY2luZz0iMC4zZW0iPnYgaSBlIHQgcCBoIHU8L3RleHQ+Cjwvc3ZnPg==" 
                            alt="VietPhu Logo" 
                            class="vietphu-logo">
                        Hệ Thống Quản Lý Vật Tư
                    </a>
                </h1>
            </div>
        </header>

        <div class="profile-page card" style="display: none;">
            <div class="profile-header">
                <h2>Hồ Sơ Người Dùng</h2>
                <div class="profile-actions">
                    <button class="btn btn-edit" onclick="componentManager.showInventory()">
                        Xem Kho
                    </button>
                </div>
            </div>
            <div class="profile-content">
                <div class="profile-info">
                    <div class="info-group">
                        <span class="info-label">Mã số:</span>
                        <span class="info-value" id="profileId"></span>
                    </div>
                    <div class="info-group">
                        <span class="info-label">Tên:</span>
                        <span class="info-value" id="profileName"></span>
                    </div>
                    <div class="info-group">
                        <span class="info-label">Vai trò:</span>
                        <span class="info-value" id="profileRole"></span>
                    </div>
                    <div class="info-group">
                        <span class="info-label">Số điện thoại:</span>
                        <span class="info-value" id="profilePhone"></span>
                    </div>
                </div>
                <div class="profile-stats">
                    <div class="stat-card" id="requestStats">
                        <h3>Thống Kê Yêu Cầu</h3>
                        <div class="stat-content">
                            <div class="stat-item">
                                <span class="stat-label">Tổng yêu cầu:</span>
                                <span class="stat-value" id="totalRequests">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Đang chờ:</span>
                                <span class="stat-value status-pending" id="pendingRequests">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Đã duyệt:</span>
                                <span class="stat-value status-approved" id="approvedRequests">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Từ chối:</span>
                                <span class="stat-value status-rejected" id="rejectedRequests">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="userManagement" class="card" style="display: none;">
            <h2>User Management</h2>
            <div class="user-lists">
                <div class="approvers">
                    <h3>Approvers</h3>
                    <ul id="approversList"></ul>
                </div>
                <div class="requesters">
                    <h3>Requesters</h3>
                    <ul id="requestersList"></ul>
                </div>
            </div>
        </div>
        
        <div class="request-section card">
            <div class="section-header">
                <h2>
                    <svg class="request-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" 
                              stroke-linecap="round" 
                              stroke-linejoin="round"/>
                        <path d="M15 2H9a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1z" 
                              stroke-linecap="round" 
                              stroke-linejoin="round"/>
                        <path d="M12 11v6M9 14h6" 
                              stroke-linecap="round" 
                              stroke-linejoin="round"/>
                    </svg>
                    Yêu Cầu Vật Tư
                </h2>
            </div>
            <p class="helper-text">Chỉ người phê duyệt có thể xem và quản lý yêu cầu</p>
            <div id="requestsList"></div>
        </div>

        <div class="scanner-section card">
            <div class="section-header">
                <h2>
                    <svg class="qr-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M3 3h7v7H3z" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M14 3h7v7h-7z" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M3 14h7v7H3z" stroke-linecap="round" stroke-linejoin="round"/>
                        <rect x="14" y="14" width="3" height="3" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M20 14v3m0 4v-4m-3 4h3" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Quét Mã QR Vật Tư</span>
                </h2>
            </div>
            <div class="scanner-content">
                <button id="startCameraBtn" class="btn btn-edit camera-btn">
                    <svg class="camera-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                        <circle cx="12" cy="13" r="4"/>
                    </svg>
                    Bật Camera
                </button>
                <div id="reader" style="display: none;"></div>
                <div id="result"></div>
                <div class="scan-instructions">
                    <p>
                        <div class="instruction-header">
                            <svg class="instruction-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M12 8v4M12 16h.01" 
                                      stroke-linecap="round" 
                                      stroke-linejoin="round"/>
                                <path d="M3.34 19a10 10 0 1 1 17.32 0" 
                                      stroke-linecap="round" 
                                      stroke-linejoin="round"/>
                                <path d="M21 21H3" 
                                      stroke-linecap="round" 
                                      stroke-linejoin="round"/>
                            </svg>
                            <span>Hướng camera vào mã QR của vật tư để:</span>
                        </div>
                    </p>
                    <ul>
                        <li>
                            <div class="instruction-item">
                                <svg class="approval-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M9 12l2 2 4-4" 
                                          stroke-linecap="round" 
                                          stroke-linejoin="round"/>
                                    <circle cx="12" cy="12" r="9" 
                                            stroke-linecap="round" 
                                            stroke-linejoin="round"/>
                                </svg>
                                <span>Người phê duyệt: Thêm vật tư vào kho</span>
                            </div>
                        </li>
                        <li>
                            <div class="instruction-item">
                                <svg class="request-icon-small" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" 
                                          stroke-linecap="round" 
                                          stroke-linejoin="round"/>
                                    <path d="M12 11v6M9 14h6" 
                                          stroke-linecap="round" 
                                          stroke-linejoin="round"/>
                                </svg>
                                <span>Người yêu cầu: Tạo yêu cầu vật tư</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="users-page card" style="display: none;">
            <h2>Users Management</h2>
            <div class="users-grid">
                <div class="user-section">
                    <h3>Approvers</h3>
                    <div class="user-list" id="approverList"></div>
                </div>
                <div class="user-section">
                    <h3>Requesters</h3>
                    <div class="user-list" id="requesterList"></div>
                </div>
            </div>
        </div>

        <div class="component-list card">
            <div class="component-header">
                <h2>
                    <svg class="storage-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" 
                              stroke-linecap="round" 
                              stroke-linejoin="round"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c.26.604.852.997 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" 
                              stroke-linecap="round" 
                              stroke-linejoin="round"/>
                    </svg>
                    <span>Kho Vật Tư</span>
                </h2>
                <button id="addComponentBtn" class="btn btn-edit" onclick="componentManager.showAddComponentDialog()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="20" height="20">
                        <path d="M12 5v14M5 12h14" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    Thêm Vật Tư
                </button>
            </div>
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Tìm kiếm vật tư theo tên hoặc mã số...">
            </div>
            <div class="table-responsive">
                <table id="componentTable">
                    <thead>
                        <tr>
                            <th>Mã số</th>
                            <th>Tên</th>
                            <th>Số lượng</th>
                            <th>Vị trí</th>
                            <th>Ngày nhập</th>
                            <th>Ngày xuất</th>
                            <th>Ghi chú</th>
                        </tr>
                    </thead>
                    <tbody id="componentTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add sidebar menu -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-toggle" onclick="componentManager.toggleSidebar()">
            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 12h18M3 6h18M3 18h18"/>
            </svg>
        </div>
        <div class="sidebar-content">
            <div class="user-info-mini" onclick="componentManager.handleUserInfoClick()">
                <div class="user-avatar">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                </div>
                <div class="user-details">
                    <span id="sidebarUserName">Hồ sơ người dùng (Chưa đăng nhập)</span>
                    <span id="sidebarUserRole" class="user-role"></span>
                </div>
            </div>
            <nav class="sidebar-nav">
                <a href="#" onclick="componentManager.showHomePage()" class="nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M3 12l9-9 9 9h-2v8a1 1 0 0 1-1 1h-12a1 1 0 0 1-1-1v-8h-2z" 
                              stroke-linecap="round" 
                              stroke-linejoin="round"/>
                    </svg>
                    Trang Chủ
                </a>
                <a href="#" onclick="componentManager.showInventory()" class="nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M20 7h-7L10 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z" 
                              stroke-linecap="round" 
                              stroke-linejoin="round"/>
                    </svg>
                    Kho Vật Tư
                </a>
                <div id="adminMenu" style="display: none;">
                    <a href="#" onclick="componentManager.showUsersPage()" class="nav-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        Quản Lý Người Dùng
                    </a>
                </div>
            </nav>
        </div>
    </div>

    <!-- Add request form template -->
    <div id="requestFormTemplate" style="display: none;">
        <div class="request-form">
            <div class="form-header">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik0yMCAxMkg4MEw5MCA2MEgxMEwyMCAxMloiIHN0cm9rZT0iIzAwZmY4OCIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxwYXRoIGQ9Ik0zNSAyNUw1MCA1MEw2NSAyNSIgc3Ryb2tlPSIjMDBmZjg4IiBzdHJva2Utd2lkdGg9IjIiLz4KPHRleHQgeD0iNTAiIHk9IjgwIiBmb250LXNpemU9IjEyIiBmaWxsPSIjMDBmZjg4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBsZXR0ZXItc3BhY2luZz0iMC4zZW0iPnYgaSBlIHQgcCBoIHU8L3RleHQ+Cjwvc3ZnPg==" 
                     alt="VietPhu Logo" 
                     class="form-logo">
                <div class="form-date">
                    <span>Ngày yêu cầu: </span>
                    <span id="requestDate"></span>
                </div>
            </div>
            <h2 class="form-title">Phiếu Yêu Cầu Vật Tư</h2>
            <div class="form-content">
                <div class="form-group">
                    <label>Mã yêu cầu:</label>
                    <span id="requestId"></span>
                </div>
                <div class="form-group">
                    <label>Vật tư yêu cầu:</label>
                    <span id="componentName"></span>
                </div>
                <div class="form-group">
                    <label>Số lượng:</label>
                    <span id="requestQuantity"></span>
                </div>
                <div class="form-group">
                    <label>Lý do yêu cầu:</label>
                    <span id="requestReason"></span>
                </div>
            </div>
            <div class="form-signatures">
                <div class="signature-section">
                    <div class="signature-box">
                        <div class="signature-line"></div>
                        <span class="signature-name" id="requesterName"></span>
                        <span class="signature-position" id="requesterPosition"></span>
                        <span class="signature-date" id="requesterSignDate"></span>
                    </div>
                    <p>Người yêu cầu</p>
                </div>
                <div class="signature-section">
                    <div class="signature-box">
                        <div class="signature-line"></div>
                        <span class="signature-name" id="approverName"></span>
                        <span class="signature-position" id="approverPosition"></span>
                        <span class="signature-date" id="approverSignDate"></span>
                    </div>
                    <p>Người phê duyệt</p>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html> 